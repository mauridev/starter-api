{"version":3,"sources":["../../src/controller/foodtruck.js"],"names":["config","db","api","post","authenticate","req","res","newFoodTruck","FoodTruck","name","body","foodtype","avgcost","geometry","coordinates","save","err","send","json","message","get","find","foodtrucks","findById","params","id","foodtruck","put","delete","deleteOne","_id","newReview","Review","title","text","review","reviews","push"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AAEA;;;;kBAEc,gBAAmB;AAAA,MAAhBA,MAAgB,QAAhBA,MAAgB;AAAA,MAARC,EAAQ,QAARA,EAAQ;;AAC/B,MAAIC,MAAM,sBAAV;;AAEA;;AAEA;AACAA,MAAIC,IAAJ,CAAS,MAAT,EAAiBC,4BAAjB,EAA+B,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC3C,QAAIC,eAAe,IAAIC,mBAAJ,EAAnB;AACAD,iBAAaE,IAAb,GAAoBJ,IAAIK,IAAJ,CAASD,IAA7B;AACAF,iBAAaI,QAAb,GAAwBN,IAAIK,IAAJ,CAASC,QAAjC;AACAJ,iBAAaK,OAAb,GAAuBP,IAAIK,IAAJ,CAASE,OAAhC;AACAL,iBAAaM,QAAb,CAAsBC,WAAtB,GAAoCT,IAAIK,IAAJ,CAASG,QAAT,CAAkBC,WAAtD;;AAEAP,iBAAaQ,IAAb,CAAkB,eAAO;AACvB,UAAIC,GAAJ,EAAS;AACPV,YAAIW,IAAJ,CAASD,GAAT;AACD;AACDV,UAAIY,IAAJ,CAAS,EAAEC,SAAS,8BAAX,EAAT;AACD,KALD;AAMD,GAbD;;AAeA;AACAjB,MAAIkB,GAAJ,CAAQ,GAAR,EAAahB,4BAAb,EAA2B,UAACC,GAAD,EAAMC,GAAN,EAAc;AACvCE,wBAAUa,IAAV,CAAe,EAAf,EAAmB,UAACL,GAAD,EAAMM,UAAN,EAAqB;AACtC,UAAIN,GAAJ,EAAS;AACPV,YAAIW,IAAJ,CAASD,GAAT;AACD;AACDV,UAAIY,IAAJ,CAASI,UAAT;AACD,KALD;AAMD,GAPD;;AASA;AACApB,MAAIkB,GAAJ,CAAQ,MAAR,EAAgB,UAACf,GAAD,EAAMC,GAAN,EAAc;AAC5BE,wBAAUe,QAAV,CAAmBlB,IAAImB,MAAJ,CAAWC,EAA9B,EAAkC,UAACT,GAAD,EAAMU,SAAN,EAAoB;AACpD,UAAGV,GAAH,EAAQ;AACNV,YAAIW,IAAJ,CAASD,GAAT;AACD;AACDV,UAAIY,IAAJ,CAASQ,SAAT;AACD,KALD;AAMD,GAPD;;AAUA;AACAxB,MAAIyB,GAAJ,CAAQ,MAAR,EAAgB,UAACtB,GAAD,EAAMC,GAAN,EAAc;AAC5BE,wBAAUe,QAAV,CAAmBlB,IAAImB,MAAJ,CAAWC,EAA9B,EAAkC,UAACT,GAAD,EAAMU,SAAN,EAAmB;AACnD,UAAIV,GAAJ,EAAS;AACPV,YAAIW,IAAJ,CAASD,GAAT;AACD;AACDU,gBAAUjB,IAAV,GAAiBJ,IAAIK,IAAJ,CAASD,IAA1B;AACAiB,gBAAUX,IAAV,CAAgB,eAAO;AACrB,YAAGC,GAAH,EAAQ;AACNV,cAAIW,IAAJ,CAASD,GAAT;AACD;AACDV,YAAIY,IAAJ,CAAS,EAAEC,SAAS,wBAAX,EAAT;AACD,OALD;AAMD,KAXD;AAYD,GAbD;;AAeA;AACAjB,MAAI0B,MAAJ,CAAW,MAAX,EAAmB,UAACvB,GAAD,EAAMC,GAAN,EAAc;AAC/BE,wBAAUqB,SAAV,CAAoB;AAClBC,WAAKzB,IAAImB,MAAJ,CAAWC;AADE,KAApB,EAEG,UAACT,GAAD,EAAMU,SAAN,EAAoB;AACrB,UAAIV,GAAJ,EAAS;AACPV,YAAIW,IAAJ,CAASD,GAAT;AACD;AACDV,UAAIY,IAAJ,CAAS,EAAEC,SAAS,iCAAX,EAAT;AACD,KAPD;AAQD,GATD;;AAWA;AACA;AACAjB,MAAIC,IAAJ,CAAS,kBAAT,EAA6B,UAACE,GAAD,EAAMC,GAAN,EAAc;AACzCE,wBAAUe,QAAV,CAAmBlB,IAAImB,MAAJ,CAAWC,EAA9B,EAAkC,UAACT,GAAD,EAAMU,SAAN,EAAoB;AACpD,UAAGV,GAAH,EAAQ;AACNV,YAAIW,IAAJ,CAASD,GAAT;AACD;;AAED,UAAIe,YAAY,IAAIC,gBAAJ,EAAhB;AACAD,gBAAUE,KAAV,GAAkB5B,IAAIK,IAAJ,CAASuB,KAA3B;AACAF,gBAAUG,IAAV,GAAiB7B,IAAIK,IAAJ,CAASwB,IAA1B;AACAH,gBAAUL,SAAV,GAAsBA,UAAUI,GAAhC;AACAC,gBAAUhB,IAAV,CAAe,UAACC,GAAD,EAAMmB,MAAN,EAAiB;AAC9B,YAAGnB,GAAH,EAAQ;AACNV,cAAIW,IAAJ,CAASD,GAAT;AACD;AACHU,kBAAUU,OAAV,CAAkBC,IAAlB,CAAuBN,SAAvB;AACAL,kBAAUX,IAAV,CAAe,UAACC,GAAD,EAAMU,SAAN,EAAoB;AACjC,cAAGV,GAAH,EAAQ;AACNV,gBAAIW,IAAJ,CAASD,GAAT;AACD;AACDV,cAAIY,IAAJ,CAAS,EAAEC,SAAS,0BAAX,EAAT;AACD,SALD;AAMD,OAXC;AAYH,KArBC;AAsBH,GAvBC;;AA2BA,SAAOjB,GAAP;AACD,C","file":"foodtruck.js","sourcesContent":["import mongoose from 'mongoose';\r\nimport { Router } from 'express';\r\nimport FoodTruck from '../model/foodtruck';\r\nimport Review from '../model/review';\r\n\r\nimport { authenticate } from '../middleware/authMiddleware';\r\n\r\nexport default({ config, db}) => {\r\n  let api = Router();\r\n\r\n  //CRUD - Create Read Update Delete Operations\r\n\r\n  // '/v1/foodtruck/reviews/add' -Create\r\n  api.post('/add', authenticate, (req, res) => {\r\n    let newFoodTruck = new FoodTruck();\r\n    newFoodTruck.name = req.body.name;\r\n    newFoodTruck.foodtype = req.body.foodtype;\r\n    newFoodTruck.avgcost = req.body.avgcost;\r\n    newFoodTruck.geometry.coordinates = req.body.geometry.coordinates;\r\n\r\n    newFoodTruck.save(err => {\r\n      if (err) {\r\n        res.send(err);\r\n      }\r\n      res.json({ message: 'FoodTruck saved successfully'});\r\n    });\r\n  });\r\n\r\n  // '/v1/foodtruck' - Read\r\n  api.get('/', authenticate, (req, res) => {\r\n    FoodTruck.find({}, (err, foodtrucks) => {\r\n      if (err) {\r\n        res.send(err);\r\n      }\r\n      res.json(foodtrucks)\r\n    });\r\n  });\r\n\r\n  // 'v1/foodtruck/:id' - Read 1\r\n  api.get('/:id', (req, res) => {\r\n    FoodTruck.findById(req.params.id, (err, foodtruck) => {\r\n      if(err) {\r\n        res.send(err);\r\n      }\r\n      res.json(foodtruck);\r\n    });\r\n  });\r\n\r\n\r\n  //'v1/foodtruck/:id' -Update\r\n  api.put('/:id', (req, res) => {\r\n    FoodTruck.findById(req.params.id, (err, foodtruck) =>{\r\n      if (err) {\r\n        res.send(err);\r\n      }\r\n      foodtruck.name = req.body.name;\r\n      foodtruck.save( err => {\r\n        if(err) {\r\n          res.send(err);\r\n        }\r\n        res.json({ message: \"FoodTruck info updated\" });\r\n      });\r\n    });\r\n  });\r\n\r\n  //'v1/foodtruck/:id' -- Delete\r\n  api.delete('/:id', (req, res) => {\r\n    FoodTruck.deleteOne({\r\n      _id: req.params.id\r\n    }, (err, foodtruck) => {\r\n      if (err) {\r\n        res.send(err);\r\n      }\r\n      res.json({ message: \"FoodTruck successfully Removed!\"});\r\n    });\r\n  });\r\n\r\n  //add review for a specifc foodtruck id\r\n  // '/v1/foodtruck/reviews/add/:id'\r\n  api.post('/reviews/add/:id', (req, res) => {\r\n    FoodTruck.findById(req.params.id, (err, foodtruck) => {\r\n      if(err) {\r\n        res.send(err);\r\n      }\r\n\r\n      let newReview = new Review();\r\n      newReview.title = req.body.title;\r\n      newReview.text = req.body.text;\r\n      newReview.foodtruck = foodtruck._id;\r\n      newReview.save((err, review) => {\r\n        if(err) {\r\n          res.send(err);\r\n        }\r\n      foodtruck.reviews.push(newReview);\r\n      foodtruck.save((err, foodtruck) => {\r\n        if(err) {\r\n          res.send(err);\r\n        }\r\n        res.json({ message: 'Food truck review saved!'});\r\n      });\r\n    });\r\n  });\r\n});\r\n\r\n\r\n\r\n  return api;\r\n}\r\n"]}
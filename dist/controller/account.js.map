{"version":3,"sources":["../../src/controller/account.js"],"names":["config","db","api","post","req","res","Account","register","username","body","email","password","err","account","send","passport","authenticate","session","status","scope","generateAccessToken","respond","get","logout","json","user"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;kBAGe,gBAAoB;AAAA,QAAjBA,MAAiB,QAAjBA,MAAiB;AAAA,QAATC,EAAS,QAATA,EAAS;;AAC/B,QAAIC,MAAM,sBAAV;;AAEA;AACAA,QAAIC,IAAJ,CAAS,WAAT,EAAsB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAChCC,0BAAQC,QAAR,CAAiB,IAAID,iBAAJ,CAAY;AACzBE,sBAAUJ,IAAIK,IAAJ,CAASC;AADM,SAAZ,CAAjB,EAEIN,IAAIK,IAAJ,CAASE,QAFb,EAEuB,UAASC,GAAT,EAAcC,OAAd,EAAuB;AAC1C,gBAAID,GAAJ,EAAS;AACLP,oBAAIS,IAAJ,CAASF,GAAT;AACH;;AAEDG,+BAASC,YAAT,CACI,OADJ,EACa;AACLC,yBAAS;AADJ,aADb,EAGOb,GAHP,EAGYC,GAHZ,EAGiB,YAAM;AACfA,oBAAIa,MAAJ,CAAW,GAAX,EAAgBJ,IAAhB,CAAqB,kCAArB;AACH,aALL;AAMH,SAbD;AAcH,KAfD;;AAkBA;AACAZ,QAAIC,IAAJ,CAAS,QAAT,EAAmBY,mBAASC,YAAT,CACf,OADe,EACN;AACLC,iBAAS,KADJ;AAELE,eAAO;AAFF,KADM,CAAnB,EAIQC,mCAJR,EAI6BC,uBAJ7B;;AAQA;AACAnB,QAAIoB,GAAJ,CAAQ,QAAR,EAAkBN,4BAAlB,EAAgC,UAACZ,GAAD,EAAMC,GAAN,EAAc;AAC1CA,YAAIkB,MAAJ;AACAlB,YAAIa,MAAJ,CAAW,GAAX,EAAgBJ,IAAhB,CAAqB,yBAArB;AACH,KAHD;;AAKA;AACAZ,QAAIoB,GAAJ,CAAQ,KAAR,EAAeN,4BAAf,EAA6B,UAACZ,GAAD,EAAMC,GAAN,EAAc;AACvCA,YAAIa,MAAJ,CAAW,GAAX,EAAgBM,IAAhB,CAAqBpB,IAAIqB,IAAzB;AACH,KAFD;;AAIA,WAAOvB,GAAP;AACH,C","file":"account.js","sourcesContent":["import mongoose from 'mongoose';\r\nimport { Router } from 'express';\r\nimport Account from '../model/account';\r\nimport bodyParser from 'body-parser';\r\nimport passport from 'passport';\r\nimport config from '../config';\r\n\r\nimport { generateAccessToken, respond, authenticate } from '../middleware/authMiddleware';\r\n\r\n\r\nexport default ({ config, db }) => {\r\n    let api = Router();\r\n\r\n    // '/v1/account'\r\n    api.post('/register', (req, res) => {\r\n        Account.register(new Account({ \r\n            username: req.body.email \r\n        }), req.body.password, function(err, account) {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n\r\n            passport.authenticate(\r\n                'local', {\r\n                    session: false\r\n                })(req, res, () => {\r\n                    res.status(200).send('Successfully created new account');\r\n                });    \r\n        });\r\n    });\r\n\r\n\r\n    // 'v1/account/login'\r\n    api.post('/login', passport.authenticate(\r\n        'local', {\r\n            session: false,\r\n            scope: []\r\n        }), generateAccessToken, respond);\r\n    \r\n\r\n\r\n    // '/v1/account/logout\r\n    api.get('logout', authenticate, (req, res) => {\r\n        res.logout();\r\n        res.status(200).send('Successfully logged out');\r\n    });\r\n        \r\n    // '/v1/account/me'\r\n    api.get('/me', authenticate, (req, res) => {\r\n        res.status(200).json(req.user);\r\n    });\r\n\r\n    return api;\r\n}"]}